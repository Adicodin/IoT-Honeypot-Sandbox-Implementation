<!DOCTYPE html>
<html>
<head>
  <title>MalwarePot Live Dashboard</title>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background: #121212;
      color: #e0e0e0;
      padding: 30px;
      margin: 0;
    }
    h1 {
      text-align: center;
      color: #ff5c5c;
      margin-bottom: 20px;
    }
    .stats {
      display: flex;
      gap: 20px;
      justify-content: center;
      margin-bottom: 30px;
      flex-wrap: wrap;
    }
    .card {
      background: #1f1f1f;
      padding: 20px;
      border-radius: 10px;
      text-align: center;
      flex: 1 1 200px;
    }
    .card h2 {
      margin: 0 0 10px;
      font-size: 1.2em;
      color: #aaa;
    }
    .card p {
      margin: 0;
      font-size: 1.8em;
      color: #fff;
    }
    .feed {
      max-height: 400px;
      overflow-y: auto;
      margin-bottom: 20px;
    }
    .feed-item {
      background: #1b1b1b;
      padding: 15px;
      border-radius: 8px;
      margin-bottom: 10px;
    }
    .feed-item h3 {
      margin: 0 0 5px;
      font-size: 1em;
      color: #ffd700;
    }
    .feed-item p {
      margin: 0;
      font-size: 0.9em;
      color: #ccc;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }
    th, td {
      padding: 10px;
      text-align: left;
      border-bottom: 1px solid #333;
    }
    th {
      background: #222;
    }
    tr:hover {
      background: #292929;
    }
    a {
      color: #61dafb;
      text-decoration: none;
    }
  </style>
</head>
<body>
  <h1>üõ°Ô∏è MalwarePot Live Dashboard</h1>

  <div class="stats">
    <div class="card">
      <h2>Total Files Scanned</h2>
      <p id="total-files">0</p>
    </div>
    <div class="card">
      <h2>IoT Malware Detected</h2>
      <p id="iot-threats">0</p>
    </div>
    <div class="card">
      <h2>Last Updated</h2>
      <p id="last-updated">-</p>
    </div>
  </div>

  <div class="feed" id="live-feed"></div><br><br>

<h2 style="margin-top:40px; color:#61dafb;">üì° IoT-Specific Malware</h2>
<table>
  <thead>
    <tr>
      <th>Time</th>
      <th>Source</th>
      <th>Name</th>
      <th>Type</th>
      <th>Detections</th>
      <th>VT Link</th>
      <th>Download Sample</th>
    </tr>
  </thead>
  <tbody id="iot-table"></tbody>
</table>

<br><br><br>
<h2 style="margin-top:40px; color:#61dafb;">üì° Captured Malware</h2>
  <table>
    <thead>
      <tr>
        <th>Time</th>
        <th>Source</th>
        <th>Name</th>
        <th>Type</th>
        <th>Detections</th>
        <th>VT Link</th>
        <th>Download Sample</th>
      </tr>
    </thead>
    <tbody id="details-table"></tbody>
  </table>

  <script>
    function fetchMalwareRecords() {
      fetch('/api/malware-records')
        .then(response => response.json())
        .then(data => {
          console.log("Fetched records:", data);
          document.getElementById('total-files').textContent = data.length;
	  document.getElementById('iot-threats').textContent = data.filter(r => r.is_iot).length;
          document.getElementById('last-updated').textContent = new Date().toLocaleTimeString();

          let feed = document.getElementById('live-feed');
          feed.innerHTML = '';
          data.slice(0, 8).forEach(r => {
            let item = document.createElement('div');
            item.className = 'feed-item';
            item.innerHTML = `<h3>${r.malware_name}</h3><p>${r.timestamp} ‚Äî <b>${r.source}</b> ‚Äî ${r.detections}</p>`;
            feed.appendChild(item);
          });

	let iotTable = document.getElementById('iot-table');
	iotTable.innerHTML = '';
	data.filter(r => r.is_iot).forEach(r => {
	  let row = `<tr>
	    <td>${r.timestamp}</td>
	    <td>${r.source}</td>
	    <td>${r.malware_name}</td>
	    <td>${r.type}</td>
	    <td>${r.detections}</td>
	    <td><a href="${r.vt_link}" target="_blank">View</a></td>
            <td><a href="${r.malwarebazaar_link}" target="_blank">Malware Sample</a></td>
	  </tr>`;
	  iotTable.innerHTML += row;
	});


          let table = document.getElementById('details-table');
          table.innerHTML = '';
          data.forEach(r => {
            let row = `<tr>
              <td>${r.timestamp}</td>
              <td>${r.source}</td>
              <td>${r.malware_name}</td>
              <td>${r.type}</td>
              <td>${r.detections}</td>
              <td><a href="${r.vt_link}" target="_blank">View</a></td>
              <td><a href="${r.malwarebazaar_link}" target="_blank">Malware Sample</a></td>
            </tr>`;
            table.innerHTML += row;
          });
        });
    }
    setInterval(fetchMalwareRecords, 3000);
    fetchMalwareRecords();
  </script>

</body>
</html>
